{"version":3,"sources":["app.coffee"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["(($) ->\r\n\r\n    # Custom single/double click listener\r\n    # Reference: http://stackoverflow.com/questions/6330431/jquery-bind-double-click-and-single-click-separately\r\n    $.fn.singleDoubleClick = (singleClickCallback, doubleClickCallback, timeout) ->\r\n        this.each ->\r\n            clicks = 0\r\n            self = this\r\n            $(this).click (event)->\r\n                clicks++;\r\n                if clicks is 1\r\n                    setTimeout ->\r\n                        if clicks is 1\r\n                            singleClickCallback.call(self, event)\r\n                        else\r\n                            doubleClickCallback.call(self, event)\r\n                        clicks = 0;\r\n                    , (timeout || 250)\r\n\r\n    init = ->\r\n        initAjaxCSRF()\r\n        initBreadcrumb()\r\n        initFileSelection()\r\n        initNewFolder()\r\n        initUpload()\r\n        initRename()\r\n        initDeletion()\r\n        initTooltip()\r\n\r\n    initAjaxCSRF = ->\r\n        $.ajaxSetup\r\n            headers:\r\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr(\"content\") # Set up CSRF Token for every AJAX request\r\n\r\n    initTooltip = ->\r\n        $('[data-toggle=\"tooltip\"]').tooltip()\r\n\r\n    initNewFolder = ->\r\n        $(\"#new_folder\").on \"click\", ->\r\n            $(this).prop(\"disabled\", true)\r\n            insertObject(\"directory\", true)\r\n            names = []\r\n\r\n            $(\".object\").each ->\r\n                basename = $(this).data(\"basename\")\r\n\r\n                if basename.indexOf(\"Untitled Folder\") > -1\r\n                    basename = basename.replace(\"Untitled Folder\", \"\").trim()\r\n                    if not basename\r\n                        basename = 1\r\n                    names.push(parseInt(basename,10))\r\n\r\n            if names.length > 0\r\n                newFolder = \"Untitled Folder #{Math.max.apply(Math, names) + 1}\"\r\n            else\r\n                newFolder = \"Untitled Folder\"\r\n\r\n            $(\"#input-folder\").val(\"#{newFolder}\").focus().select() # Increment and populate the new Untitled Folder\r\n\r\n        $(\"#file_system\").on \"focusout\", \".object .name #input-folder\", ->\r\n            $(this).parent().trigger(\"submit\")\r\n            return false\r\n\r\n        $(\"#file_system\").on \"submit\", \"#create-form\", (e) ->\r\n            e.preventDefault()\r\n\r\n            if not $(\"#input-folder\").val()\r\n                $(this).parents(\"object-container\").remove()\r\n                $(\"#new_folder\").prop(\"disabled\", false)\r\n                return false\r\n\r\n            currentObject = $(this).parents(\".object\")\r\n            currentObject.first().addClass(\"uploading\") # Add uploading animation\r\n\r\n            $.ajax\r\n                url: \"/manager/put/directory\",\r\n                data:\r\n                    path: $(\"#file_system\").data(\"dirpath\")\r\n                    dirName: $(\"#input-folder\").val()\r\n                type: \"PUT\"\r\n                dataType: \"json\"\r\n            .success (response) ->\r\n                # Remove form and populate meta data\r\n                populateMeta(currentObject, \"directory\", response)\r\n                initFileSelection(currentObject)\r\n            .fail (response) ->\r\n                # Show error message\r\n                alert(\"Failed to create the folder\")\r\n                $(this).parents(\".object\").removeClass(\"uploading\")\r\n                .find(\"input-folder\").focus().select()\r\n            .done (response) ->\r\n                $(\"#new_folder\").prop(\"disabled\", false)\r\n\r\n    initBreadcrumb = ->\r\n        fullPath = $(\"#file_system\").data(\"dirpath\")\r\n\r\n        if fullPath is '/'\r\n            return false\r\n\r\n        currentLink = \"/home\"\r\n        $.each fullPath.split('/'), (index, node) ->\r\n            currentLink += \"/#{node}\"\r\n            $(\".breadcrumb\").append(\"\"\"<li class=\"breadcrumb-item\"><a href=\"#{currentLink}\">#{node}</a></li>\"\"\")\r\n\r\n    initUpload = ->\r\n        $(\"#fileupload\").on \"change\", ->\r\n            files = this.files\r\n            maxFileSize = $(\"#file_system\").data(\"maxfilesize\") - 512 # Consider POST overhead\r\n\r\n            $.each files, (index, file) ->\r\n                if file.size > maxFileSize\r\n                    alert \"File #{file.name} is too large\"\r\n                    return false\r\n\r\n            formData = new FormData($(\"#upload\")[0])\r\n\r\n            $.ajax\r\n                url: \"/manager/put/file\",\r\n                type: \"POST\"\r\n                dataType: \"json\"\r\n                data: formData\r\n                cache: false\r\n                contentType: false # Prevent jQuery from processing the data\r\n                processData: false\r\n            .success (responses) ->\r\n                $(responses.errors).each (index, error) ->\r\n                    console.log error\r\n                $(responses.success).each (index, file) ->\r\n                    newObject = $(insertObject(\"file\", false)).children()\r\n                    populateMeta(newObject, \"file\", file)\r\n                    initFileSelection(newObject)\r\n            .fail ->\r\n                alert(\"Upload failed\")\r\n\r\n    insertObject = (objectType, newObject) ->\r\n        nameInput = \"\"\"\r\n            <form id=\"create-form\">\r\n                <label for=\"input-folder\" class=\"sr-only\">New folder</label>\r\n                <input type=\"text\" placeholder=\"Folder Name\" id=\"input-folder\" class=\"text-center\">\r\n                <input type=\"hidden\" name=\"_method\" value=\"PUT\">\r\n            </form>\r\n            \"\"\"\r\n\r\n        if newObject\r\n            name = nameInput\r\n        else\r\n            name = null\r\n\r\n        objectModel = \"\"\"\r\n             <div class=\"col-xs-4 col-sm-3 col-md-2 object-container\">\r\n                 <div data-basename=\"\" data-mime=\"\" data-filetype=\"\" class=\"object object-new\">\r\n                     <div class=\"icon-container\">\r\n                         <div class=\"icon-base #{objectType}\"></div>\r\n                         <div class=\"icon-main\"></div>\r\n                     </div>\r\n                     <div class=\"name-container\">\r\n                         <div title=\"\" class=\"name text-primary\" role=\"button\">\r\n                            #{name}\r\n                         </div>\r\n                         <div class=\"meta-info text-muted\"></div>\r\n                     </div>\r\n                 </div>\r\n             </div>\r\n             \"\"\"\r\n\r\n        if objectType is \"directory\"\r\n            return $(objectModel).prependTo( \"#file_system\" )\r\n        else if objectType is \"file\"\r\n            return $(objectModel).hide().appendTo( \"#file_system\" ).fadeIn(500)\r\n\r\n    populateMeta = (object, objectType, objectMeta) ->\r\n        if not objectMeta.pathinfo.dirname\r\n            link = \"/home#{objectMeta.path}\"\r\n        else\r\n            link = \"/home/#{objectMeta.path}\"\r\n\r\n        object.removeClass(\"uploading\").removeClass(\"renaming\").removeClass(\"object-new\") # Remove uploading animation\r\n        .data(\"filetype\", objectMeta.mime)\r\n        .data(\"basename\", objectMeta.pathinfo.basename)\r\n        .data(\"fullpath\", objectMeta.path)\r\n        .find(\".name\").empty() # Replace name class with new data\r\n        .append(\"\"\"<a class=\"link\" href=\"#{link}\">#{objectMeta.pathinfo.basename}</a> <a href=\"#\" class=\"hide rename\"><span class=\"glyphicon glyphicon-pencil\" aria-hidden=\"true\"></a>\"\"\")\r\n        .parent().children(\".meta-info\").empty() # Replace last modified time with \"Just now\"\r\n        .append(\"<div class=\\\"meta-info text-muted\\\">Just now</div>\")\r\n\r\n    initRename = () ->\r\n        $(\"#file_system\").on \"click\", \".object .rename\", (e) ->\r\n            e.preventDefault()\r\n            renameInput($(this).parents(\".object\"))\r\n            return false\r\n\r\n        $(\"#file_system\").on \"focusout\", \".object .name #input-file\", ->\r\n            $(this).parent().trigger(\"submit\")\r\n            return false\r\n\r\n        $(\"#file_system\").on \"submit\", \"#rename-form\", (e) ->\r\n            e.preventDefault()\r\n\r\n            currentObject = $(this).parents(\".object\")\r\n            oldName = currentObject.data(\"basename\")\r\n            newName = $(this).children(\"#input-file\").val()\r\n            fileType = currentObject.data(\"filetype\")\r\n\r\n            if not newName or (oldName is newName) # No name change\r\n                $(this).parent().find(\"a\").show()\r\n                $(this).remove()\r\n                return false\r\n\r\n            currentObject.addClass(\"renaming\") # Add renaming effects\r\n\r\n            $.ajax\r\n                url: \"/manager/move\",\r\n                data:\r\n                    path: $(\"#file_system\").data(\"dirpath\")\r\n                    oldName: oldName\r\n                    newName: newName\r\n                    fileType: fileType\r\n                type: \"POST\"\r\n                dataType: \"json\"\r\n            .success (response) ->\r\n                # Remove form and populate meta data\r\n                currentObject.find(\".name\").empty()\r\n                populateMeta(currentObject, fileType, response)\r\n            .fail ->\r\n                # Show error message\r\n                alert(\"Failed to rename the object\")\r\n                currentObject.removeClass(\"renaming\").find(\".name a\").show()\r\n                currentObject.find(\"#rename-form\").remove()\r\n            return false\r\n\r\n    renameInput = (object) ->\r\n        oldName = object.data(\"basename\");\r\n        nameInput = \"\"\"\r\n            <form id=\"rename-form\">\r\n                <label for=\"input-file\" class=\"sr-only\">File Name</label>\r\n                <input type=\"text\" placeholder=\"Folder Name\" id=\"input-file\" class=\"text-center\" value=\"#{oldName}\">\r\n            </form>\r\n            \"\"\"\r\n\r\n        object.find(\".name a\").hide()\r\n        $(nameInput).prependTo(object.find(\".name\")).find(\"#input-file\").focus().select()\r\n\r\n    initFileSelection = (object) ->\r\n        if not object\r\n            object = $(\"#file_system .object\")\r\n\r\n        object.singleDoubleClick(\r\n            (() ->\r\n                $(this).toggleClass(\"selected\")),\r\n            (() ->\r\n                if ($(this).data(\"filetype\") is \"directory\")\r\n                    $(\"#file_system\").addClass(\"loading\")\r\n                window.location = ($(this).find(\".link\").attr(\"href\"))))\r\n\r\n    initDeletion = () ->\r\n        $(\"#delete_object\").on \"click\", ->\r\n            selectedFiles = $(\".selected\")\r\n\r\n            if selectedFiles.length is 0\r\n                alert \"Please select object(s) first\"\r\n                return false\r\n\r\n            $(this).prop(\"disabled\", true)\r\n\r\n            selectedFiles.each (index, file) ->\r\n                fileType = $(file).data(\"filetype\")\r\n                $.ajax\r\n                    url: \"/manager/delete\",\r\n                    data:\r\n                        path: $(file).data(\"fullpath\")\r\n                        fileType: fileType\r\n                    type: \"DELETE\"\r\n                    dataType: \"json\"\r\n                .success ->\r\n                    # Remove form and populate meta data\r\n                    $(file).fadeOut 500, ->\r\n                        $(this).parent().remove()\r\n                .fail ->\r\n                    # Show error message\r\n                    alert(\"\"\"Failed to delete #{fileType} #{$(file).data(\"basename\")}\"\"\")\r\n                .done ->\r\n                    $(\"#delete_object\").prop(\"disabled\", false) # Enable delete button\r\n\r\n    return init()\r\n\r\n) jQuery\r\n"]}